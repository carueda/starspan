#!@SH@
#
# starspan - launcher script
# $Id$
#

BINDIR=`dirname $0`

# The proper StarSpan binary:
STARSPAN2=$BINDIR/starspan2

export LD_LIBRARY_PATH=@GDAL_PREFIX@/lib:$LD_LIBRARY_PATH
export LD_LIBRARY_PATH=@GEOS_PREFIX@/lib:$LD_LIBRARY_PATH

# mainly for --run command
export PATH=@GDAL_PREFIX@/bin:@GEOS_PREFIX@/bin:$PATH

# $JARS: the following jars should be present under this directory:
#
# Required by the --view_geometries option:
#      plotapplication.jar
# Can be download from http://ptolemy.eecs.berkeley.edu/java/ptplot
# Currently the version 5.1p2 is used.
#
# Required by the --test and --jts options:
#      xerces.jar
#      jts-1.4.0.jar
#      jdom.jar
#      JTS_Test.jar
#      Acme.jar
# These can be downloaded from http://www.vividsolutions.com/jts/jtshome.htm 
# Currently JTS 1.4 is used.
#
JARS=$BINDIR/starspan.jars/

function usage() {
	cat << EOF

starspan extended usage:

    starspan --view_geometries dumped_geometries.csv
        launches the ptPlot application with the given file.
        Normally dumped_geometries.csv was generated by 
		"starspan --dump_geometries dumped_geometries.csv ..."
            
    starspan --test args...
        launches the JTS Test Runner
        Typically this is called:
            starspan --test -files a_test.xml
        where a_test.xml was generated by "starspan --jtstest a_test.xml ..."
            
    starspan --jts
        launches the JTS Test Builder as a way to visualize the
        geometries involved in tests.
        Choose "File->Open XML file(s)..." to open an .xml file
        generated by "starspan --jtstest ..."

    starspan --run cmd args ...
        Runs a command under the same environment as that of the
		StarSpan system.
        E.g.  starspan --run ogrinfo -al a_vector_file 

EOF
	return;
}

if [ "$1" == "--xhelp" ]; then
	usage
	exit

elif [ "$1" == "--view_geometries" ]; then
	echo "[Launching ptplot...]"
	shift
	CP=$CLASSPATH
	CP=$JARS/plotapplication.jar:$CP
	java -Xmx256m -cp $CP ptolemy.plot.PlotApplication $*

elif [ "$1" == "--test" ]; then
	echo "[Launching JTS TopologyTestApp...]"
	shift
	CP=$CLASSPATH
	for i in $JARS/*.jar; do CP=$i:$CP; done
	java -Xmx256m -cp $CP com.vividsolutions.jtstest.testrunner.TopologyTestApp $*

elif [ "$1" == "--jts" ]; then
	echo "[Launching JTSTestBuilder...]"
	shift
	CP=$CLASSPATH
	for i in $JARS/*.jar; do CP=$i:$CP; done
	java -Xmx256m -cp $CP com.vividsolutions.jtstest.testbuilder.JTSTestBuilder $*

elif [ "$1" == "--run" ]; then
	shift
	cmd=$*
	echo "[Running $cmd]"
	$cmd

else
	# call starspan2
	$STARSPAN2 $*
fi

