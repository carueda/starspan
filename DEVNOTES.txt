starspan devnotes
$Id$

2004-10-18
	Starting to use geos::Polygonizer as a means to fix bad polys.
	(geos::Polygonizer is not yet in the 2.0.1 official release, I'm using
	the CVS snapshop.)
	The idea is to node the segments defining a "bad" (self-intersecting) 
	polygon, and then polygonize the resulting multilinestring.
	See Traverser#processPolygon().
	
	(my first test of Polygonizer was in java using JTS directly:  
	See java/src/starspan/tools/PolygonizerTest.java.)
	

2004-10-14 (0.88beta)
	New option -RID_as_given: by default, RIDs are the filenames without
	any path. With this option RIDs will take the filenames exactly as
	given in the command line.
	
	
2004-10-12 (0.87beta)
	Some cleanup and checks for memory leaks:
		- StatsObserver.computeResults(): vector of values released.
		- Traverser::processPolygon: geos_poly released.
		- Traverser: pixset : Duplication of pixel is always checked
		  for all intersections types except for polygons.  
		  pixset is reset on a per feature basis, so potential duplication
		  of pixels accross features won't be detected.
		- There is a minor memory leak in GDAL 1.2.3 (geotiff.cpp:3787)
		  that is already fixed in CVS. I will wait for next GDAL release.
		  
	Option -skip_invalid_polys. By default all polygons will be processed.
		
2004-10-11 (0.86beta)
	Traverser::processPolygon: now catches GEOS exceptions which
	may occur when a pixel is intersected with a self-intersecting
	polygon; to be more specific it seems the problem arises when 
	the self-intersection happens to be in the area involved in the 
	pixel/poly intersection.
	Currently the exceptions are just ignored so the process can
	continue.
	An environmental variable STARSPAN_DUMP_POLYS_ON_EXCEPTION controls
	if the involved polygons should be WKT-printed to stderr.
	An appropiated solution to this case is PENDING.
	See http://geos.refractions.net/pipermail/geos-devel/2004-September/001045.html
	
	
2004-10-08 (0.86beta)
	new  util/Progress class.
	Traverser: options for progress and verbose output.
	
	added Traverser::processMultiPolygon
	added Traverser::processGeometryCollection
	
	Traverser::setVerbose
	Traverser::setProgress
	Traverser::setLog

2004-10-07 (0.85beta)

	traverser::processPolygon_point removed.  Now intersection
	of pixels and polygons are only done according to proportion of
	intersected area (0.5 by default).
	(previous revisions: traverser.cc,v 1.34,  traverser.h,v 1.25)
	
	GDAL note:  Use -D_FILE_OFFSET_BITS=64 for C flags before
	./configure'ing GDAL in case large file support (LFS) is not working
	properly.  (I fixed this kind of problem on pavo machine today.)

2004-10-06 (0.84beta)
	New scheme for -calbase command:
	-calbase linkname output.csv stat1 stat2 ...
	-vector V                 : with field linkname (eg. Cal_ID)
	-speclib F                : csv format:  linkname,1,2,...,m
	-raster R1 ...            : images
	
	stat1 stat2 ... are optional desired statistics from rasters; by
	default AVG is calculated

	This is based on the following additions/changes:

	New method Traverser#setDesiredFeatureByField(fieldname, fieldvalue).
	New starspan_getFeatureStatsByField
	starspan_tuct2.cc: entry point: starspan_tuct_2(...)
	First tests: OK
	
	New scheme for stats calculation: now based on a band-oriented fashion,
	which should be more efficient according to GDAL model although efficiency
	also depends on the specific interleave of raster datasets; in particular
	BSQ is the preferred interleave for band-wise calculations.
	Included "mode" statistic.

2004-10-04 (0.83beta)
	starspan_stats.cc: new starspan_getFeatureStats(FID,vect,rast,stats)
	to get statistics for FID in raster rast. StatsObserver was adjusted
	to support the new service.
	
	starspan_tuct1.cc: code for new ''-calbase outfile'' command. 
	This command expects inputs -vector V, -raster R1 R2 ..., 
	and (new) -speclib F.
	starspan create outfile in CSV format with the following scheme:
		FID,RID,BandNumber,FieldBandValue,ImageBandValue
		
2004-09-30 (0.82beta)
	starspan_stats: bug fixed: I was calling pixels.empty() instead
	of pixels.clear()!
	
	select_fields is now a pointer to a vector.
	
	-stats: now it also process selection of fields (-fields ...)
	
2004-09-29 (0.81beta)

	-dump_geometries: new testing operation (implemented in
	starspan_dump.cc) to generate plot of geometries and raster extent.
	This provides a better control on visualization. 
	Output format is the textual form accepted by the Ptolemy Plot
	library, http://ptolemy.eecs.berkeley.edu/java/ptplot/ .
	A new extended usage option --view_geometries launches the
	ptplotapplication tool.
	
	typical usage:
		starspan -vector V -raster R -dump_geometries mygeometries.csv
		starspan --view_geometries mygeometries.csv
	
	LineRasterizer: Now uses origin (x0,y0) to make a proper traslation
	before calling the bresenham algorithm. Preliminary tests (via
	--view_geometries) give now accurate results.
	
	Makefile.props.templ:  New scheme for Makefile.
	This template is to create Makefile.props according to settings
	in the local system.  Now Makefile includes Makefile.props.
	A new property STARSPAN_PREFIX specifies where the starspan tool
	will be installed.
	
	starspan shell script updated with better documentation about
	Java archive dependencies (extended usage).
	

2004-09-28 (0.8beta)
	StatsObserver: vector<Pixel> pixels (was vector<Pixel*>).
	
	getBandValues renamed to getBandValuesForPixel in both Raster and Traveser
	classes.
	
2004-09-27 (0.8beta)
	-update_{csv,dbf} options: fixed bug: col,row were not made 0-based for
	proper extraction.
	
2004-09-26 (0.7beta)
	pixel duplicates revisited:
	
		LineRasterizer#line now includes flag 'last' to indicate if ending
		pixel should be reported.
		
		LineRasterizer: more tests to verify intersections by using
		JTS test builder and Envi ...
	
2004-09-25
	stats: fixed extraction bug: (col,row) were 1-based via TraversalEvent's, 
	but then used as 0-based.
	As a general revision, all (col,row) locations are now 0-based in traverser
	module, and clients have been adjusted to report them as 1-based.
	
	building with GDAL 1.2.3 .. ok
	
2004-09-24
	traverser: 
		new Observer#end() to notify observer when process
		has finished.
	
		now list of observers: addObserver instead of setObserver
		
	StatsObserver: new observer to compute basic statistics.
	command-line scheme:
		-stats [avg | stdev | min | max ]... file.csv
		
2004-09-16
	starspan2.cc: collect args before creating main objects.
	(arg processing might be based on getopt or similar in a future version.)
	
	New module csv to read CSV files--adapted from TPOP source code
	http://cm.bell-labs.com/cm/cs/tpop/code.html
	
	New operation starspan_update_csv
	New operation starspan_update_dbf
	
	(I started to use GDAL 1.2.2 which was just realeased today.)
	
	-envisl:  name for spectra: FID:col:row:x:y
	
	New options:
		-noColRow: do not include col,row fields in -csv, -dbf
		-noXY:     do not include x,y fields in -csv, -dbf
	
2004-09-13
	General refactoring to allow the processing of multiple input rasters.
	Traverser has now methods to specify data input objects; all object
	interfaces updated.
	
	All output formats updated for multi raster processing:
		-envi, -envisl: A check is done to verify that all bands are
		                the same type.
		
		-jtstest: checks only one raster is specified.
		
		-mr: checks only one raster is specified; should be fixed for
		multiple rasters but this is NOT going to be done for now.
		    
	
	starspan_gen_envisl: 
		Data file is basename.img for Envi image, and basename.sld for
		spectral library.
		In header for .img: samples = 1; lines = #pixels; bands = #bands
		In header for .sld: samples = #bands; lines = #pixels; bands = 1
		Note: data file is written out in exactly the same way (bip interleave).
	
2004-09-11
	Problems with large file support; this is happening on ceres but
	works fine on scorpio and px (my laptop). 
	I'm also having a strange behavior with gdal not being able to 
	recognize an envi image on scorpio, though it just reads fine on
	ceres and px (?).
	
2004-09-10
	Band# names now starting from 1.
	
	-envi:  creates envi image
	-envisl:  creates envi spectral library
	
	Option -fields fieldname1,fieldname2,... to select fields from vector file.
	In the case of envi output (-envi, -envisl), the following files will
	be generated:
	will generate:
		<basename>_<fieldname1>.ser
		<basename>_<fieldname2>.ser
		...
		
	starspan_gen_envisl.cc #includes <list.h> although it should be <list>.
	For some reason <list> does not compile on scorpio, gcc 3.3.4!
	(<list> compiles just fine with my gcc 2.95.4).
	
	
2004-09-09
	TraversalEvent: (col,row) is now (1,1)-based (to be more
	compatible with standard tools, e.g. envi).
	
	starspan_jtstest: new parameter use_polys to represent pixels as
	polygons (rectangles) for visualization in the JTS test builder.
	
	Some cleaning up and minor refactoring before working on multiple
	raster inputs.
	
2004-09-08
	New option -csv to generate a CSV output file.
	Option -db renamed to -dbf
	
	Traverser: new approach for pixel inclusion in intersections
	resulting in polygons. A parameter pixelProprtion is used.
	New option -pixprop.
	Basic scheme implemented but should be adjusted for better 
	efficiency.
	New option -fid.
	
	JTS_TestGenerator: now a case can be cancelled, useful when empty
	arguments are found.
	
2004-09-07
	Complete build process revised and reported in
	http://starspan.casil.ucdavis.edu/?Build
	Makefile: GDAL_SRC_DIR to specify where GDAL sources are
	installed. Other locations also specified via definitions.
	NOTE: A more general scheme (maybe via configure) is
	still required for a smooth build.
	
	New objects for traversal: TraversalEvent, PixelLocation
	
	starspan_db: now puts: FID, col,row, {vect-attrs}, {rast-bands}
	See doc in starspan.h
	
2004-09-06
	A second pass over the traverser module.
	It now uses a LineRasterizer to process linestrings.
	starspan_jtstest now implemented as a traverser client.
	
2004-09-05
	rasterizers/ New module for rasterizations.
	Now with a LineRasterizer, whose implementation is based on a
	Bresenham interpolator with sub-pixel accuracy thanks to the
	Anti-Grain Geometry engine, http://www.antigrain.com/.
	Note that all that is needed for this dependency is to
	#include agg_dda_line.h (no AGG library is required).
	
2004-08-31
	-db now includes the fields, in the given order:
		- (x,y)  location of signature
		- attributes from source geometry feature
		- band values
		
2004-08-30
	Option -db to create a DBF with pixels contained in vector features.
	Added some design documentation.
	
2004-08-22
	New option -envisl to create en envi spectral library.
	This function uses a traverser object.
	Still lacking enough testing.
	GDAL limitation: no access to wavelength metadata. 
	It seems some ENVI functionality will have to be written anyway.
	
2004-08-21
	New traverser module to provide a skeleton for basic processing.
	The observer pattern is used so interested objects can perform
	a number of tasks.

2004-08-20
	Option -in to work with -mr
	
2004-08-10
	(unsuccessful) workarounds for proper projection in mini rasters
	(beacuse of GDAL limitations).

2004-08-08
	organization
	mini raster generation, option -mr

2004-08-04
	New jts module.
	New option -jtstest that generates a JTS test suite.
	starspan has started passing the first tests :-)

2004-08-03
	In order to have GEOS functionality from within GDAL I did
	the following:
	
		Installed GEOS:
			- ``cvs co geos''
			- ./autogen.sh && ./configure && make && make install
			  I fixed some minor errors about comparisons, but
			  I hacked the Makefile to replace INTERFACE_* for
			  arbitrary numbers. ;-(  I couldn't find any help about
			  this error.  Finally it compiled
			  
		Installed GDAL:
			- ``cvs checkout gdal''  to have the most recent GDAL source
			  (since GEOS is not yet officially released).
			- ./configure --with-geos=/usr/local/bin/geos-config
			- ``make'' (I fixed some minor errors in ogrgeometry.cpp)
			- ``make install''
			
	starspan2.cc: initial version with geom->Contains(point) and a very
	simple report of points contained in the geometries of the vector datasource.
			
	

2004-08-02
	Working now on the C++ code.
	New interface modules:
		vector/Vector.h   with shapelib and OGR implementations
		raster/Raster.h   with GDAL implementation

2004-08-01
	Geotools: I was not able to find a good Java library to work on
	rasters in different formats (not even for Envi files). Although I have
	written some code for Envi in BIP format (SAMS), I would spend a lot
	of time writing the map management and the BSQ and BIL interleaves.
	I'll continue with the C++ approach.
	
2004-07-29
	First geotools tests OK ;-)
	See java/README.txt
	
2004-07-28
	GeoTools seems an interesting way to go:
	  - http://docs.codehaus.org/display/GEOTOOLS/Data+access+basic+tutorial
	    Data access basic tutorial -- shapefile example
	Also JTS Topology Suite - http://www.vividsolutions.com/jts/JTSHome.htm
	(in fact geotools uses JTS)
	I'll try geotools ..
	 

	
---- C/C++ code -----

SHPLIB
	Some tests to link against the shplib library:
		make
		export LD_LIBRARY_PATH=/usr/local/lib
		./shpdump  # OK
		
CGAL
	I installed CGAL-3.0.1 to support the implementation of
	Polygon.h
	
	
	
-------- Original Message --------
Subject: 	shapefile path
Date: 	Fri, 23 Jul 2004 14:25:47 -0700
From: 	Ramirez, Carlos <cmiramirez@ucdavis.edu>
To: 	<carueda@ucdavis.edu>, <greenberg@ucdavis.edu>

\\scorpio\cstars.ucdavis.edu\proj\delta\Delta2000004\gis\vector\shapefile 
 
-------- Original Message --------
Subject: 	last year's imagery
Date: 	Fri, 23 Jul 2004 14:33:04 -0700
From: 	Ramirez, Carlos <cmiramirez@ucdavis.edu>
To: 	<carueda@ucdavis.edu>, <greenberg@ucdavis.edu>

\\ceres.cstars.ucdavis.edu\home\gis-data\hyvista\delta_2003

