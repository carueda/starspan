starspan devnotes
$Id$
                                    

2005-03-23 (0.962beta)
	Usage message reorganized: testing and other developer
	oriented options are shown with --help-dev.
	
	New method traverser.getPixelSetSize(), which is now
	used in MiniRasterObserver.intersectionEnd().
	
	New static method Stats.computeCounts() to count the number of 
	occurrences of each value in a vector<int>.
	
	Method Traverser.getPixelSet() removed. Other minor changes
	to documentation in traverser.h.
	
	Added methods in Traverser:
	  getPixelIntegerValuesInBand(unsigned band_index, vector<int>& list);
	  getPixelDoubleValuesInBand(unsigned band_index, vector<double>& list);
	which work on set of visited pixels in current feature.
	
2005-03-04 (0.961beta)
	starspan_update_csv.cc: simple printf-to-cout changes
	Minor text updates in starspan script.
	
2005-02-26 (0.961beta)                  
	Added option --separation <num-pixels> to include a	separation
	between minirasters in strip. Feature request #200074.
	
	starspan_miniraster.cc: Since ENVI complains about "Unknown" projections
	(which us the map info created by GDAL by default),	I decided to set
	this projection explicitly by using the projection from the (arbitrarely
	chosen) first miniraster. Now ENVI opens the generated strips without 
	any complain. This fixes bug #200073
	
	--report now also shows projection info for rasters.
	
	starspan_miniraster.cc: workaround to GDAL bug which
	generates repeated header items when FlushCache is called
	multiple time on an ENVI dataset.
	
2005-02-19 (0.96beta)
	--buffer <distance> [<quadrantSegments>]
	If the parameter starts with '@', then it will be interpreted as the
	name of the attribute from which the value will be obtained. Example:
		--buffer @buf_distance 21
	indicates that the buffer distance is to be taken from the field 
	buf_distance in the corresponding geometry feature; the quadrantSegments
	is fixed to 21.  This fulfills request #200066
	
	--mini_raster_parity {even | odd | @<field>}  
	Implemented. This fulfills request #200069
	
	--mr renamed to --mini_rasters
	
	Tests pending for --buffer and --mini_raster_parity.
	
2005-02-19 (0.952beta)
	- Making a source distribution. Example:
		make dist VERSION=0.1                     
	  which is the same as:
	  	./mksrcdist.sh 0.1
	- polygon/ moved to libtests/ and NOT added to cvs (this is old stuff).
	- java/ moved to libtests/ and ADDED to cvs.

2005-02-19 (0.951beta)
	- new scheme to make source distribution (see mksrcdist.sh)
	- source restructuring. These dirs were moved to src/:
		csv jts raster rasterizers stats traverser util vector
	
2005-02-18 (0.95beta)
	- Top-level sources moved to src/
	
2005-02-16 (0.95beta)
	- 0.94beta released.
	- starting 0.95beta

2005-02-16 (0.94beta)
	- minirasterstrip:
		- fid strip now also created. I tried to use RasterIO
		  documented capability of replicating a value; however it seems
		  it's buggy so as a workaround I'm just making the buffer the same
		  size of the region I want to fill with the replicated value.
		  "Background" value for the fid strip is -1 as normally FIDs start
		  from zero.
		  
		- loc strip now also created.  (background values x=y=0 --arbitrarely)
		
		- also set background value 0 for raster strip in all bands.
		
		Visual tests in Envi: OK
		Added test case in tests/Makefile with comparison of data files.
		For some reason .hdr  files are created with mapinfo repeated several 
		times (gdal bug?)
		
	- Fixed a minor formatting in creation of filenames for minirasters to 
	  keep compatibility with the way this used to be done with standard C: 
		Now: ... << setfill('0') << setw(4) << FID ...
		  
	
	
2005-02-15 (0.94beta)
	- mini raster strip command: implementation restarted based on
	MiniRasterObserver. A subclass MiniRasterStripObserver uses a
	list of basic info about each generated miniraster (mrbi_list)
	to merge the minirasters into the final strip.
	The basic functionality is now working (tested visually in envi).
	Next: 
		- create the accompanying .fid and .glt rasters.
		- delete temporary minirasters
		
	(Note: starspan_miniraster_strip.cc no longer used; all this is
	implemented in starspan_minirasters.cc)
	
	- Comments about --O and --outformat proposed variations in: 
	http://casil.ucdavis.edu/tracker/?func=detail&aid=200072&group_id=48&atid=350112
	
	
2005-02-12 (0.94beta)
	- starting 0.94beta
	- I just grabbed the last GDAL cvs snapshot and build a fresh gdal. I see
	that vrtdataset.h (among others that used to be under frmts) are now siblings
	of gdal.h under GDAL_PREFIX/include/.  So a future version of our Makefile
	will use only the GDAL_PREFIX. (No more GDAL_SRC_DIR).

	
2005-02-11 (0.93beta)
	- starting 0.93beta.
	- New Makefile.props.fink (jgrn307)
	- added INCLUDE += -I$(GDAL_SRC_DIR) in Makefile (jgrn307)
	- More documentation in Makefile
	- copyright.txt added
	- README.txt now with a general description of the tool
	- new doc/srccontents.txt (with old readme contents)
	- TODO: clean up starspan script from particular settings!


2005-02-10 (0.92beta)
	- Makefile changes and new target `dist' to create a source distribution
	  from current CVS repository. E.g:
		make dist VERSION=0.92beta
	  created:
	  	DISTDIR/starspan-0.92beta.tar.gz
	
2005-02-07 (0.92beta)
	- Starting to work on new --mini_raster_strip option.
	  See starspan_miniraster_strip.cc (partially implemented)
	  
	- INSTALL.txt created (based on http://starspan.casil.ucdavis.edu/?Build)
	
2005-02-04 (0.92beta)
	- setting up a test scheme: new directory tests/ and 
	  tests/Makefile to apply tests. 
	  New target `test' in master Makefile.
	  
	  Structure under tests/ is as follows:
	  
	  	data/           Contains all required raster, vector, and other data
		                on which tests are to be performed.
		expected/       Contains data used as expected outputs from starspan.
		                Currently it contains data generated by starspan itself
						but that have been checked externally with Envi.
		generated/      This is created and populated by running the
		                test cases in Makefile.
						
	  Currently the validation scheme is based on cmp-ing (binary comparing)
	  the outputs in generated/ with corresponding expected outputs in
	  expected/.
	
	- new --buffer option. Also included a basic test case.
	  

2005-02-02 (0.92beta)
	- new traverser services to get access to set of visited pixel during
	  current intersecting feature.
	- miniraster using nodata value to nullify pixels outside geometries.

2005-02-01 (0.92beta)
	--nodata added

2005-01-24 (0.92beta)
	All options with double dash.
	New option --version.
	
2005-01-24 (0.92beta)
	starspan_minirasters.cc revisited: Now using traverser scheme
	(first tests..)

2005-01-23 (0.91beta)

	Simplified dependencies scheme:
	
		- No more external dependency on AGG. Now the following AGG headers
		(from the agg22.tar.gz distribution) are kept under rasterizers/
			agg_basics.h
			agg_dda_line.h
		(even these headers will eventually be eliminated after a pending
		revision of the line rasterizer.)

		- DBF format support dropped: no more shapelib dependency.
		The following sources are no longer maintained:
			starspan_db.cc
			starspan_update_dbf.cc
			
		In summary, the only dependencies are now GEOS and GDAL.

2004-11-13
	New options: -raster_field, -raster_directory
	starspan_csv_raster_field.cc
	Working only for points.
	
	MyPolygonizer eliminated; now geos::Polygonizer makes proper destruction.
	
	
2004-11-12  ****
Reverting to version at 2004-11-09  -- cvs -q update -D "2004-11-09"
	P starspan.h
	P starspan2.cc
	P starspan_csv.cc
	P starspan_jtstest.cc
	P raster/Raster.h
	P raster/Raster_gdal.cc
	P traverser/traverser.cc
	P traverser/traverser.h
I'm keeping the previous scheme for multiple raster in traverser,
but merging other changes I made:
	
	Ready.


2004-11-12 (0.9beta)
	starspan_csv: simplified scheme: each raster processed independently.
	Output scheme:
		FID, {vect-attrs}, RID, [col,row,] [x,y,] {rast-bands}
	
2004-11-10 (0.9beta)
	Quote fields in CSV if necessary.
	
	Changes to allow the input rasters to be at different locations.
	Do tests!
	
	

2004-10-21 (0.89beta)
	Some cleanup: Raster, Traverser, Stats.
	To improve performance on computation of integers:
		Traverser#getPixelIntegerValuesInBand(..)
		Stats::compute(vector<int>& values)
		StatsObserver now uses integer extraction if no band is of
		floating point type. 
		In particular, calculation of MODE should now be more efficient
		because a map<int,int> is used.
	
	Traverser::summary with some counters for a summary report.
	
2004-10-20
	More checks for malformed (WKT) geometries.
	Such a problem generates a GEOS exception but starspan was not
	catching it.
	
2004-10-18
	Starting to use geos::Polygonizer as a means to fix bad polys.
	(geos::Polygonizer is not yet in the 2.0.1 official release, I'm using
	the CVS snapshop.)
	The idea is to node the segments defining a "bad" (self-intersecting) 
	polygon, and then polygonize the resulting multilinestring.
	See Traverser#processPolygon().
	Now working.  But there are some memory leaks associated with
	Polygonizer..
	
	(my first test of Polygonizer was in java using JTS directly:  
	See java/src/starspan/tools/PolygonizerTest.java.)
	

2004-10-14 (0.88beta)
	New option -RID_as_given: by default, RIDs are the filenames without
	any path. With this option RIDs will take the filenames exactly as
	given in the command line.
	
	
2004-10-12 (0.87beta)
	Some cleanup and checks for memory leaks:
		- StatsObserver.computeResults(): vector of values released.
		- Traverser::processPolygon: geos_poly released.
		- Traverser: pixset : Duplication of pixel is always checked
		  for all intersections types except for polygons.  
		  pixset is reset on a per feature basis, so potential duplication
		  of pixels accross features won't be detected.
		- There is a minor memory leak in GDAL 1.2.3 (geotiff.cpp:3787)
		  that is already fixed in CVS. I will wait for next GDAL release.
		  
	Option -skip_invalid_polys. By default all polygons will be processed.
		
2004-10-11 (0.86beta)
	Traverser::processPolygon: now catches GEOS exceptions which
	may occur when a pixel is intersected with a self-intersecting
	polygon; to be more specific it seems the problem arises when 
	the self-intersection happens to be in the area involved in the 
	pixel/poly intersection.
	Currently the exceptions are just ignored so the process can
	continue.
	An environmental variable STARSPAN_DUMP_POLYS_ON_EXCEPTION controls
	if the involved polygons should be WKT-printed to stderr.
	An appropiated solution to this case is PENDING.
	See http://geos.refractions.net/pipermail/geos-devel/2004-September/001045.html
	
	
2004-10-08 (0.86beta)
	new  util/Progress class.
	Traverser: options for progress and verbose output.
	
	added Traverser::processMultiPolygon
	added Traverser::processGeometryCollection
	
	Traverser::setVerbose
	Traverser::setProgress
	Traverser::setLog

2004-10-07 (0.85beta)

	traverser::processPolygon_point removed.  Now intersection
	of pixels and polygons are only done according to proportion of
	intersected area (0.5 by default).
	(previous revisions: traverser.cc,v 1.34,  traverser.h,v 1.25)
	
	GDAL note:  Use -D_FILE_OFFSET_BITS=64 for C flags before
	./configure'ing GDAL in case large file support (LFS) is not working
	properly.  (I fixed this kind of problem on pavo machine today.)

2004-10-06 (0.84beta)
	New scheme for -calbase command:
	-calbase linkname output.csv stat1 stat2 ...
	-vector V                 : with field linkname (eg. Cal_ID)
	-speclib F                : csv format:  linkname,1,2,...,m
	-raster R1 ...            : images
	
	stat1 stat2 ... are optional desired statistics from rasters; by
	default AVG is calculated

	This is based on the following additions/changes:

	New method Traverser#setDesiredFeatureByField(fieldname, fieldvalue).
	New starspan_getFeatureStatsByField
	starspan_tuct2.cc: entry point: starspan_tuct_2(...)
	First tests: OK
	
	New scheme for stats calculation: now based on a band-oriented fashion,
	which should be more efficient according to GDAL model although efficiency
	also depends on the specific interleave of raster datasets; in particular
	BSQ is the preferred interleave for band-wise calculations.
	Included "mode" statistic.

2004-10-04 (0.83beta)
	starspan_stats.cc: new starspan_getFeatureStats(FID,vect,rast,stats)
	to get statistics for FID in raster rast. StatsObserver was adjusted
	to support the new service.
	
	starspan_tuct1.cc: code for new ''-calbase outfile'' command. 
	This command expects inputs -vector V, -raster R1 R2 ..., 
	and (new) -speclib F.
	starspan create outfile in CSV format with the following scheme:
		FID,RID,BandNumber,FieldBandValue,ImageBandValue
		
2004-09-30 (0.82beta)
	starspan_stats: bug fixed: I was calling pixels.empty() instead
	of pixels.clear()!
	
	select_fields is now a pointer to a vector.
	
	-stats: now it also process selection of fields (-fields ...)
	
2004-09-29 (0.81beta)

	-dump_geometries: new testing operation (implemented in
	starspan_dump.cc) to generate plot of geometries and raster extent.
	This provides a better control on visualization. 
	Output format is the textual form accepted by the Ptolemy Plot
	library, http://ptolemy.eecs.berkeley.edu/java/ptplot/ .
	A new extended usage option --view_geometries launches the
	ptplotapplication tool.
	
	typical usage:
		starspan -vector V -raster R -dump_geometries mygeometries.csv
		starspan --view_geometries mygeometries.csv
	
	LineRasterizer: Now uses origin (x0,y0) to make a proper traslation
	before calling the bresenham algorithm. Preliminary tests (via
	--view_geometries) give now accurate results.
	
	Makefile.props.templ:  New scheme for Makefile.
	This template is to create Makefile.props according to settings
	in the local system.  Now Makefile includes Makefile.props.
	A new property STARSPAN_PREFIX specifies where the starspan tool
	will be installed.
	
	starspan shell script updated with better documentation about
	Java archive dependencies (extended usage).
	

2004-09-28 (0.8beta)
	StatsObserver: vector<Pixel> pixels (was vector<Pixel*>).
	
	getBandValues renamed to getBandValuesForPixel in both Raster and Traveser
	classes.
	
2004-09-27 (0.8beta)
	-update_{csv,dbf} options: fixed bug: col,row were not made 0-based for
	proper extraction.
	
2004-09-26 (0.7beta)
	pixel duplicates revisited:
	
		LineRasterizer#line now includes flag 'last' to indicate if ending
		pixel should be reported.
		
		LineRasterizer: more tests to verify intersections by using
		JTS test builder and Envi ...
	
2004-09-25
	stats: fixed extraction bug: (col,row) were 1-based via TraversalEvent's, 
	but then used as 0-based.
	As a general revision, all (col,row) locations are now 0-based in traverser
	module, and clients have been adjusted to report them as 1-based.
	
	building with GDAL 1.2.3 .. ok
	
2004-09-24
	traverser: 
		new Observer#end() to notify observer when process
		has finished.
	
		now list of observers: addObserver instead of setObserver
		
	StatsObserver: new observer to compute basic statistics.
	command-line scheme:
		-stats [avg | stdev | min | max ]... file.csv
		
2004-09-16
	starspan2.cc: collect args before creating main objects.
	(arg processing might be based on getopt or similar in a future version.)
	
	New module csv to read CSV files--adapted from TPOP source code
	http://cm.bell-labs.com/cm/cs/tpop/code.html
	
	New operation starspan_update_csv
	New operation starspan_update_dbf
	
	(I started to use GDAL 1.2.2 which was just realeased today.)
	
	-envisl:  name for spectra: FID:col:row:x:y
	
	New options:
		-noColRow: do not include col,row fields in -csv, -dbf
		-noXY:     do not include x,y fields in -csv, -dbf
	
2004-09-13
	General refactoring to allow the processing of multiple input rasters.
	Traverser has now methods to specify data input objects; all object
	interfaces updated.
	
	All output formats updated for multi raster processing:
		-envi, -envisl: A check is done to verify that all bands are
		                the same type.
		
		-jtstest: checks only one raster is specified.
		
		-mr: checks only one raster is specified; should be fixed for
		multiple rasters but this is NOT going to be done for now.
		    
	
	starspan_gen_envisl: 
		Data file is basename.img for Envi image, and basename.sld for
		spectral library.
		In header for .img: samples = 1; lines = #pixels; bands = #bands
		In header for .sld: samples = #bands; lines = #pixels; bands = 1
		Note: data file is written out in exactly the same way (bip interleave).
	
2004-09-11
	Problems with large file support; this is happening on ceres but
	works fine on scorpio and px (my laptop). 
	I'm also having a strange behavior with gdal not being able to 
	recognize an envi image on scorpio, though it just reads fine on
	ceres and px (?).
	
2004-09-10
	Band# names now starting from 1.
	
	-envi:  creates envi image
	-envisl:  creates envi spectral library
	
	Option -fields fieldname1,fieldname2,... to select fields from vector file.
	In the case of envi output (-envi, -envisl), the following files will
	be generated:
	will generate:
		<basename>_<fieldname1>.ser
		<basename>_<fieldname2>.ser
		...
		
	starspan_gen_envisl.cc #includes <list.h> although it should be <list>.
	For some reason <list> does not compile on scorpio, gcc 3.3.4!
	(<list> compiles just fine with my gcc 2.95.4).
	
	
2004-09-09
	TraversalEvent: (col,row) is now (1,1)-based (to be more
	compatible with standard tools, e.g. envi).
	
	starspan_jtstest: new parameter use_polys to represent pixels as
	polygons (rectangles) for visualization in the JTS test builder.
	
	Some cleaning up and minor refactoring before working on multiple
	raster inputs.
	
2004-09-08
	New option -csv to generate a CSV output file.
	Option -db renamed to -dbf
	
	Traverser: new approach for pixel inclusion in intersections
	resulting in polygons. A parameter pixelProprtion is used.
	New option -pixprop.
	Basic scheme implemented but should be adjusted for better 
	efficiency.
	New option -fid.
	
	JTS_TestGenerator: now a case can be cancelled, useful when empty
	arguments are found.
	
2004-09-07
	Complete build process revised and reported in
	http://starspan.casil.ucdavis.edu/?Build
	Makefile: GDAL_SRC_DIR to specify where GDAL sources are
	installed. Other locations also specified via definitions.
	NOTE: A more general scheme (maybe via configure) is
	still required for a smooth build.
	
	New objects for traversal: TraversalEvent, PixelLocation
	
	starspan_db: now puts: FID, col,row, {vect-attrs}, {rast-bands}
	See doc in starspan.h
	
2004-09-06
	A second pass over the traverser module.
	It now uses a LineRasterizer to process linestrings.
	starspan_jtstest now implemented as a traverser client.
	
2004-09-05
	rasterizers/ New module for rasterizations.
	Now with a LineRasterizer, whose implementation is based on a
	Bresenham interpolator with sub-pixel accuracy thanks to the
	Anti-Grain Geometry engine, http://www.antigrain.com/.
	Note that all that is needed for this dependency is to
	#include agg_dda_line.h (no AGG library is required).
	
2004-08-31
	-db now includes the fields, in the given order:
		- (x,y)  location of signature
		- attributes from source geometry feature
		- band values
		
2004-08-30
	Option -db to create a DBF with pixels contained in vector features.
	Added some design documentation.
	
2004-08-22
	New option -envisl to create en envi spectral library.
	This function uses a traverser object.
	Still lacking enough testing.
	GDAL limitation: no access to wavelength metadata. 
	It seems some ENVI functionality will have to be written anyway.
	
2004-08-21
	New traverser module to provide a skeleton for basic processing.
	The observer pattern is used so interested objects can perform
	a number of tasks.

2004-08-20
	Option -in to work with -mr
	
2004-08-10
	(unsuccessful) workarounds for proper projection in mini rasters
	(beacuse of GDAL limitations).

2004-08-08
	organization
	mini raster generation, option -mr

2004-08-04
	New jts module.
	New option -jtstest that generates a JTS test suite.
	starspan has started passing the first tests :-)

2004-08-03
	In order to have GEOS functionality from within GDAL I did
	the following:
	
		Installed GEOS:
			- ``cvs co geos''
			- ./autogen.sh && ./configure && make && make install
			  I fixed some minor errors about comparisons, but
			  I hacked the Makefile to replace INTERFACE_* for
			  arbitrary numbers. ;-(  I couldn't find any help about
			  this error.  Finally it compiled
			  
		Installed GDAL:
			- ``cvs checkout gdal''  to have the most recent GDAL source
			  (since GEOS is not yet officially released).
			- ./configure --with-geos=/usr/local/bin/geos-config
			- ``make'' (I fixed some minor errors in ogrgeometry.cpp)
			- ``make install''
			
	starspan2.cc: initial version with geom->Contains(point) and a very
	simple report of points contained in the geometries of the vector datasource.
			
	

2004-08-02
	Working now on the C++ code.
	New interface modules:
		vector/Vector.h   with shapelib and OGR implementations
		raster/Raster.h   with GDAL implementation

2004-08-01
	Geotools: I was not able to find a good Java library to work on
	rasters in different formats (not even for Envi files). Although I have
	written some code for Envi in BIP format (SAMS), I would spend a lot
	of time writing the map management and the BSQ and BIL interleaves.
	I'll continue with the C++ approach.
	
2004-07-29
	First geotools tests OK ;-)
	See java/README.txt
	
2004-07-28
	GeoTools seems an interesting way to go:
	  - http://docs.codehaus.org/display/GEOTOOLS/Data+access+basic+tutorial
	    Data access basic tutorial -- shapefile example
	Also JTS Topology Suite - http://www.vividsolutions.com/jts/JTSHome.htm
	(in fact geotools uses JTS)
	I'll try geotools ..
	 

	
---- C/C++ code -----

SHPLIB
	Some tests to link against the shplib library:
		make
		export LD_LIBRARY_PATH=/usr/local/lib
		./shpdump  # OK
		
CGAL
	I installed CGAL-3.0.1 to support the implementation of
	Polygon.h
	
	
	
-------- Original Message --------
Subject: 	shapefile path
Date: 	Fri, 23 Jul 2004 14:25:47 -0700
From: 	Ramirez, Carlos <cmiramirez@ucdavis.edu>
To: 	<carueda@ucdavis.edu>, <greenberg@ucdavis.edu>

\\scorpio\cstars.ucdavis.edu\proj\delta\Delta2000004\gis\vector\shapefile 
 
-------- Original Message --------
Subject: 	last year's imagery
Date: 	Fri, 23 Jul 2004 14:33:04 -0700
From: 	Ramirez, Carlos <cmiramirez@ucdavis.edu>
To: 	<carueda@ucdavis.edu>, <greenberg@ucdavis.edu>

\\ceres.cstars.ucdavis.edu\home\gis-data\hyvista\delta_2003

